<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Card Box / Tray SVG Generator</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header class="header">
      <h1>Card Box / Tray SVG Generator</h1>
      <p class="sub">
        Runs fully in your browser (Pyodide). Generates laser-cut SVG with deterministic finger joints.
      </p>
      <div class="mode">
        <label class="check">
          <input id="studentMode" type="checkbox" checked />
          Student Mode
        </label>
      </div>
    </header>

    <main class="grid">
      <section class="card">
        <h2>Setup</h2>

        <section id="wizard" class="wizard">
          <h3>Student Mode (3 steps)</h3>

          <div class="step">
            <div class="stepTitle">Step 1 — Define the problem</div>
            <div class="row">
              <label for="dispenseType">Dispense type</label>
              <select id="dispenseType">
                <option value="stacking" selected>Stacking (cards / tiles)</option>
                <option value="flowing">Flowing (dry solids only)</option>
              </select>
            </div>
            <div class="row">
              <label for="storageTarget">Storage target</label>
              <input id="storageTarget" type="text" placeholder="e.g., 150 cards" />
            </div>
            <div class="row">
              <label for="dispenseTarget">Dispense target</label>
              <input id="dispenseTarget" type="text" placeholder="e.g., 1 card per pull" />
            </div>
          </div>

          <div class="step">
            <div class="stepTitle">Step 2 — Choose a mechanism</div>
            <div class="row">
              <label for="mechanism">Mechanism</label>
              <select id="mechanism">
                <option value="tray_open_front" selected>Open-front tray</option>
                <option value="dispenser_slot_front">Front slot dispenser</option>
                <option value="window_front">Window front</option>
                <option value="box_with_lid">Box with lid</option>
              </select>
            </div>
            <p class="hint">Choosing a mechanism will set the preset below.</p>
          </div>

          <div class="step">
            <div class="stepTitle">Step 3 — Fabrication setup</div>
            <p class="hint">
              If you don’t know kerf, generate the calibration SVG, cut it, then pick the best label.
            </p>
          </div>
        </section>

        <h3>Basic</h3>

        <div class="row">
          <label for="preset">Preset</label>
          <select id="preset">
            <option value="tray_open_front">tray_open_front</option>
            <option value="dispenser_slot_front">dispenser_slot_front</option>
            <option value="window_front">window_front</option>
            <option value="box_with_lid">box_with_lid</option>
          </select>
        </div>

        <div class="row">
          <label for="dimMode">Dimension mode</label>
          <select id="dimMode">
            <option value="internal" selected>Internal (space inside)</option>
            <option value="external">External (outside size)</option>
          </select>
        </div>

        <div class="row">
          <label for="innerWidth">Inner width (mm)</label>
          <input id="innerWidth" type="number" value="135" step="0.1" min="1" />
        </div>
        <div class="row">
          <label for="innerDepth">Inner depth (mm)</label>
          <input id="innerDepth" type="number" value="90" step="0.1" min="1" />
        </div>
        <div class="row">
          <label for="innerHeight">Inner height (mm)</label>
          <input id="innerHeight" type="number" value="225" step="0.1" min="1" />
        </div>

        <hr />

        <div class="row">
          <label for="thickness">Thickness (mm)</label>
          <input id="thickness" type="number" value="3" step="0.01" min="0.1" />
        </div>

        <div class="row">
          <label for="fit">Fit (tight → loose)</label>
          <input id="fit" type="range" min="0" max="2" step="1" value="1" />
        </div>
        <div class="readout" id="fitReadout"></div>

        <div class="readout" id="sizeReadout"></div>

        <div class="row">
          <label for="sheetWidth">Sheet width (mm)</label>
          <input id="sheetWidth" type="number" value="340" step="1" min="50" />
        </div>

        <details>
          <summary>Layout (optional)</summary>

          <div class="row">
            <label for="marginMm">Margin (mm)</label>
            <input id="marginMm" type="number" value="10" step="0.5" min="0" />
          </div>
          <div class="row">
            <label for="paddingMm">Padding (mm)</label>
            <input id="paddingMm" type="number" value="12" step="0.5" min="0" />
          </div>
          <div class="row">
            <label for="strokeMm">Stroke (mm)</label>
            <input id="strokeMm" type="number" value="0.2" step="0.05" min="0.01" />
          </div>
        </details>

        <div class="row inline">
          <label class="check">
            <input id="labels" type="checkbox" checked />
            Labels
          </label>
          <label class="check">
            <input id="lid" type="checkbox" />
            Lid (only for box_with_lid)
          </label>
        </div>

        <div class="row inline">
          <label class="check">
            <input id="holdingTabs" type="checkbox" />
            Holding tabs
          </label>
          <label for="tabWidth">Tab width (mm)</label>
          <input id="tabWidth" type="number" value="2" step="0.1" min="0" />
        </div>

        <details id="advanced">
          <summary>Advanced</summary>

          <div class="row">
            <label for="kerf">Kerf (mm)</label>
            <input id="kerf" type="number" value="0.2" step="0.01" min="0" />
          </div>
          <div class="row">
            <label for="clearance">Joint clearance (mm)</label>
            <input id="clearance" type="number" value="0.10" step="0.01" />
          </div>

          <div class="readout" id="jointRule"></div>

          <div class="row">
            <label for="calSet">Calibration set</label>
            <select id="calSet">
              <option value="student" selected>Student (tight/normal/loose)</option>
              <option value="full">Full list</option>
            </select>
          </div>

          <div class="row">
            <label for="fingerWidth">Target tab width (mm)</label>
            <input id="fingerWidth" type="number" value="" step="0.1" placeholder="(auto)" />
          </div>
          <div class="row">
            <label for="minFingers">Min tabs</label>
            <input id="minFingers" type="number" value="3" step="1" min="1" />
          </div>
        </details>

        <details>
          <summary>Preset options</summary>

          <div class="row">
            <label for="frontHeight">Front height (mm)</label>
            <input id="frontHeight" type="number" value="" step="0.1" placeholder="(auto)" />
          </div>

          <div class="row inline">
            <label class="check">
              <input id="scoop" type="checkbox" />
              Scoop (tray_open_front)
            </label>
          </div>
          <div class="row">
            <label for="scoopRadius">Scoop radius (mm)</label>
            <input id="scoopRadius" type="number" value="22" step="0.1" />
          </div>
          <div class="row">
            <label for="scoopDepth">Scoop depth (mm)</label>
            <input id="scoopDepth" type="number" value="18" step="0.1" />
          </div>

          <div class="row">
            <label for="slotWidth">Slot width (mm)</label>
            <input id="slotWidth" type="number" value="86" step="0.1" />
          </div>
          <div class="row">
            <label for="slotHeight">Slot height (mm)</label>
            <input id="slotHeight" type="number" value="18" step="0.1" />
          </div>
          <div class="row">
            <label for="slotY">Slot Y from bottom (mm)</label>
            <input id="slotY" type="number" value="38" step="0.1" />
          </div>
        </details>

        <div class="actions">
          <button id="btnGenerate" disabled>Loading Python…</button>
          <button id="btnCalibration" disabled>Generate calibration SVG</button>
          <button id="btnBundle" disabled>Download bundle (zip)</button>
        </div>

        <p class="status" id="status">Initializing…</p>
        <a class="download" id="download" download="out.svg" hidden>Download SVG</a>
        <div class="warnings" id="warnings" hidden></div>
      </section>

      <section class="card">
        <h2>Preview</h2>
        <div class="previewBar">
          <button id="zoomOut" type="button">−</button>
          <button id="zoomIn" type="button">+</button>
          <button id="fitView" type="button">Fit</button>
          <label class="check"><input id="showCut" type="checkbox" checked />CUT</label>
          <label class="check"><input id="showLabels" type="checkbox" checked />LABELS</label>
        </div>
        <div id="preview" class="preview"></div>
      </section>
    </main>

    <footer class="footer">
      <p>
        Tip: If you deploy this on GitHub Pages, it runs client-side and doesn’t need a server.
      </p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

    <script type="module" src="app.js"></script>
  </body>
</html>
